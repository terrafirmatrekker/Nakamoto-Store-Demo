{"ast":null,"code":"// Copyright (c) 2017 Pieter Wuille\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\nvar bech32 = require('./bech32');\n\nfunction convertbits(data, frombits, tobits, pad) {\n  var acc = 0;\n  var bits = 0;\n  var ret = [];\n  var maxv = (1 << tobits) - 1;\n\n  for (var p = 0; p < data.length; ++p) {\n    var value = data[p];\n\n    if (value < 0 || value >> frombits !== 0) {\n      return null;\n    }\n\n    acc = acc << frombits | value;\n    bits += frombits;\n\n    while (bits >= tobits) {\n      bits -= tobits;\n      ret.push(acc >> bits & maxv);\n    }\n  }\n\n  if (pad) {\n    if (bits > 0) {\n      ret.push(acc << tobits - bits & maxv);\n    }\n  } else if (bits >= frombits || acc << tobits - bits & maxv) {\n    return null;\n  }\n\n  return ret;\n}\n\nfunction decode(hrp, addr) {\n  var dec = bech32.decode(addr);\n\n  if (dec === null || dec.hrp !== hrp || dec.data.length < 1 || dec.data[0] > 16) {\n    return null;\n  }\n\n  var res = convertbits(dec.data.slice(1), 5, 8, false);\n\n  if (res === null || res.length < 2 || res.length > 40) {\n    return null;\n  }\n\n  if (dec.data[0] === 0 && res.length !== 20 && res.length !== 32) {\n    return null;\n  }\n\n  return {\n    version: dec.data[0],\n    program: res\n  };\n}\n\nfunction encode(hrp, version, program) {\n  var ret = bech32.encode(hrp, [version].concat(convertbits(program, 8, 5, true)));\n\n  if (decode(hrp, ret) === null) {\n    return null;\n  }\n\n  return ret;\n}\n\nfunction isValidAddress(address, hrp) {\n  var hrp = hrp || 'bc';\n  var ret = decode(hrp, address);\n\n  if (ret === null) {\n    hrp = 'tb';\n    ret = decode(hrp, address);\n  }\n\n  if (ret === null) {\n    return false;\n  }\n\n  var recreate = encode(hrp, ret.version, ret.program);\n  return recreate === address.toLowerCase();\n}\n\nmodule.exports = {\n  encode: encode,\n  decode: decode,\n  isValidAddress: isValidAddress\n};","map":null,"metadata":{},"sourceType":"script"}