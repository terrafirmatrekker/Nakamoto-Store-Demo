{"ast":null,"code":"'use strict';\n\nvar _ = require('lodash');\n\nvar errors = require('./errors');\n\nvar $ = require('./util/preconditions');\n\nvar UNITS = {\n  'BTC': [1e8, 8],\n  'mBTC': [1e5, 5],\n  'uBTC': [1e2, 2],\n  'bits': [1e2, 2],\n  'satoshis': [1, 0]\n};\n/**\n * Utility for handling and converting bitcoins units. The supported units are\n * BTC, mBTC, bits (also named uBTC) and satoshis. A unit instance can be created with an\n * amount and a unit code, or alternatively using static methods like {fromBTC}.\n * It also allows to be created from a fiat amount and the exchange rate, or\n * alternatively using the {fromFiat} static method.\n * You can consult for different representation of a unit instance using it's\n * {to} method, the fixed unit methods like {toSatoshis} or alternatively using\n * the unit accessors. It also can be converted to a fiat amount by providing the\n * corresponding BTC/fiat exchange rate.\n *\n * @example\n * ```javascript\n * var sats = Unit.fromBTC(1.3).toSatoshis();\n * var mili = Unit.fromBits(1.3).to(Unit.mBTC);\n * var bits = Unit.fromFiat(1.3, 350).bits;\n * var btc = new Unit(1.3, Unit.bits).BTC;\n * ```\n *\n * @param {Number} amount - The amount to be represented\n * @param {String|Number} code - The unit of the amount or the exchange rate\n * @returns {Unit} A new instance of an Unit\n * @constructor\n */\n\nfunction Unit(amount, code) {\n  if (!(this instanceof Unit)) {\n    return new Unit(amount, code);\n  } // convert fiat to BTC\n\n\n  if (_.isNumber(code)) {\n    if (code <= 0) {\n      throw new errors.Unit.InvalidRate(code);\n    }\n\n    amount = amount / code;\n    code = Unit.BTC;\n  }\n\n  this._value = this._from(amount, code);\n  var self = this;\n\n  var defineAccesor = function defineAccesor(key) {\n    Object.defineProperty(self, key, {\n      get: function get() {\n        return self.to(key);\n      },\n      enumerable: true\n    });\n  };\n\n  Object.keys(UNITS).forEach(defineAccesor);\n}\n\nObject.keys(UNITS).forEach(function (key) {\n  Unit[key] = key;\n});\n/**\n * Returns a Unit instance created from JSON string or object\n *\n * @param {String|Object} json - JSON with keys: amount and code\n * @returns {Unit} A Unit instance\n */\n\nUnit.fromObject = function fromObject(data) {\n  $.checkArgument(_.isObject(data), 'Argument is expected to be an object');\n  return new Unit(data.amount, data.code);\n};\n/**\n * Returns a Unit instance created from an amount in BTC\n *\n * @param {Number} amount - The amount in BTC\n * @returns {Unit} A Unit instance\n */\n\n\nUnit.fromBTC = function (amount) {\n  return new Unit(amount, Unit.BTC);\n};\n/**\n * Returns a Unit instance created from an amount in mBTC\n *\n * @param {Number} amount - The amount in mBTC\n * @returns {Unit} A Unit instance\n */\n\n\nUnit.fromMillis = Unit.fromMilis = function (amount) {\n  return new Unit(amount, Unit.mBTC);\n};\n/**\n * Returns a Unit instance created from an amount in bits\n *\n * @param {Number} amount - The amount in bits\n * @returns {Unit} A Unit instance\n */\n\n\nUnit.fromMicros = Unit.fromBits = function (amount) {\n  return new Unit(amount, Unit.bits);\n};\n/**\n * Returns a Unit instance created from an amount in satoshis\n *\n * @param {Number} amount - The amount in satoshis\n * @returns {Unit} A Unit instance\n */\n\n\nUnit.fromSatoshis = function (amount) {\n  return new Unit(amount, Unit.satoshis);\n};\n/**\n * Returns a Unit instance created from a fiat amount and exchange rate.\n *\n * @param {Number} amount - The amount in fiat\n * @param {Number} rate - The exchange rate BTC/fiat\n * @returns {Unit} A Unit instance\n */\n\n\nUnit.fromFiat = function (amount, rate) {\n  return new Unit(amount, rate);\n};\n\nUnit.prototype._from = function (amount, code) {\n  if (!UNITS[code]) {\n    throw new errors.Unit.UnknownCode(code);\n  }\n\n  return parseInt((amount * UNITS[code][0]).toFixed());\n};\n/**\n * Returns the value represented in the specified unit\n *\n * @param {String|Number} code - The unit code or exchange rate\n * @returns {Number} The converted value\n */\n\n\nUnit.prototype.to = function (code) {\n  if (_.isNumber(code)) {\n    if (code <= 0) {\n      throw new errors.Unit.InvalidRate(code);\n    }\n\n    return parseFloat((this.BTC * code).toFixed(2));\n  }\n\n  if (!UNITS[code]) {\n    throw new errors.Unit.UnknownCode(code);\n  }\n\n  var value = this._value / UNITS[code][0];\n  return parseFloat(value.toFixed(UNITS[code][1]));\n};\n/**\n * Returns the value represented in BTC\n *\n * @returns {Number} The value converted to BTC\n */\n\n\nUnit.prototype.toBTC = function () {\n  return this.to(Unit.BTC);\n};\n/**\n * Returns the value represented in mBTC\n *\n * @returns {Number} The value converted to mBTC\n */\n\n\nUnit.prototype.toMillis = Unit.prototype.toMilis = function () {\n  return this.to(Unit.mBTC);\n};\n/**\n * Returns the value represented in bits\n *\n * @returns {Number} The value converted to bits\n */\n\n\nUnit.prototype.toMicros = Unit.prototype.toBits = function () {\n  return this.to(Unit.bits);\n};\n/**\n * Returns the value represented in satoshis\n *\n * @returns {Number} The value converted to satoshis\n */\n\n\nUnit.prototype.toSatoshis = function () {\n  return this.to(Unit.satoshis);\n};\n/**\n * Returns the value represented in fiat\n *\n * @param {string} rate - The exchange rate between BTC/currency\n * @returns {Number} The value converted to satoshis\n */\n\n\nUnit.prototype.atRate = function (rate) {\n  return this.to(rate);\n};\n/**\n * Returns a the string representation of the value in satoshis\n *\n * @returns {string} the value in satoshis\n */\n\n\nUnit.prototype.toString = function () {\n  return this.satoshis + ' satoshis';\n};\n/**\n * Returns a plain object representation of the Unit\n *\n * @returns {Object} An object with the keys: amount and code\n */\n\n\nUnit.prototype.toObject = Unit.prototype.toJSON = function toObject() {\n  return {\n    amount: this.BTC,\n    code: Unit.BTC\n  };\n};\n/**\n * Returns a string formatted for the console\n *\n * @returns {string} the value in satoshis\n */\n\n\nUnit.prototype.inspect = function () {\n  return '<Unit: ' + this.toString() + '>';\n};\n\nmodule.exports = Unit;","map":null,"metadata":{},"sourceType":"script"}